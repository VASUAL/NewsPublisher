{"ast":null,"code":"import request from \"../utils/request\";\nimport $ from \"../assets/js/jquery-3.6.0\";\nimport { ElMessage } from \"element-plus\";\nimport moment from \"moment\";\nimport HeadOfHome from \"../components/HeadOfHome\";\nimport Star from \"@element-plus/icons/lib/Star\";\nimport StarFilled from \"@element-plus/icons/lib/StarFilled\";\nimport E from 'wangeditor';\nlet newsId;\nlet newsAuthor;\nlet userEmail;\nlet editor;\nexport default {\n  name: \"NewsContent\",\n  components: {\n    HeadOfHome,\n    Star,\n    StarFilled\n  },\n\n  data() {\n    return {\n      boyHeadAuthor: false,\n      girlHeadAuthor: false,\n      notCollect: false,\n      collected: false,\n      total: 0,\n      pageSize: 5,\n      currentPage: 1,\n      tableDataForComment: [],\n      textarea: '',\n      commentArea: false,\n      newsAuthor: newsAuthor,\n      messageForm: {\n        userFrom: '',\n        userTo: '',\n        headline: '',\n        content: '',\n        date: '',\n        state: 0\n      },\n      dialogFormVisible: false\n    };\n  },\n\n  methods: {\n    handleCurrentChange() {\n      this.loadCommentData();\n    },\n\n    //加载新闻内容数据\n    loadNewsData() {\n      newsId = this.$route.query.newsId;\n      console.log(newsId); //使该新闻的点击量加1\n\n      request.post(\"/news/increaseNewsClick\", newsId).then(res => {\n        request.post(\"/news_User/getNewsById\", newsId).then(res => {\n          $('#type').text(res.data.type);\n          $('#headline').text(res.data.headline);\n\n          if (res.data.sex === \"男\") {\n            this.boyHeadAuthor = true;\n            this.girlHeadAuthor = false;\n          } else {\n            this.boyHeadAuthor = false;\n            this.girlHeadAuthor = true;\n          }\n\n          $('#author').text(res.data.petname);\n          $('#date').text(moment(res.data.date).format(\"YYYY-MM-DD\"));\n          $('#content').html(res.data.content);\n          newsAuthor = res.data.author;\n        });\n      });\n    },\n\n    //加载评论数据\n    loadCommentData() {\n      request.get(\"/comment_User/getAllCommentByNewsId\", {\n        params: {\n          newsId: newsId,\n          currentPage: this.currentPage,\n          pageSize: this.pageSize\n        }\n      }).then(res => {\n        if (res.data.records.length === 0) {} else {\n          for (let i = 0; i < res.data.records.length; i++) {\n            res.data.records[i].date = moment(res.data.records[i].date).format(\"YYYY-MM-DD\");\n          }\n\n          this.tableDataForComment = res.data.records;\n          this.total = res.data.total;\n          this.commentArea = true;\n        }\n      });\n    },\n\n    //发表评论\n    publishComment() {\n      if (this.textarea === null || this.textarea === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请输入评论'\n        });\n      } else if (userEmail === null || userEmail === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        });\n      } else {\n        let comment = {\n          newsId: newsId,\n          author: userEmail,\n          content: this.textarea\n        };\n        request.post(\"/comment/insertComment\", comment).then(res => {\n          ElMessage({\n            type: 'success',\n            message: '评论成功'\n          });\n          request.post(\"/news/increaseNewsComment\", newsId).then(res => {\n            $('#comment').val(\"\"); //清空评论区\n\n            this.loadCommentData();\n          });\n        });\n      }\n    },\n\n    //关注新闻作者\n    focusNewsAuthor() {\n      if (userEmail === null || userEmail === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        });\n      } else {\n        request.get(\"/focus/focusUser\", {\n          params: {\n            userFrom: userEmail,\n            userTo: newsAuthor\n          }\n        }).then(res => {\n          if (res.code === \"0\") {\n            ElMessage({\n              type: 'success',\n              message: '关注成功，可在个人中心查看'\n            });\n          } else {\n            ElMessage({\n              type: 'warning',\n              message: '您已经关注过了，可在个人中心查看'\n            });\n          }\n        });\n      }\n    },\n\n    //关注评论作者\n    focusCommentAuthor(author) {\n      if (userEmail === null || userEmail === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        });\n      } else {\n        request.get(\"/focus/focusUser\", {\n          params: {\n            userFrom: userEmail,\n            userTo: author\n          }\n        }).then(res => {\n          if (res.code === \"0\") {\n            ElMessage({\n              type: 'success',\n              message: '关注成功，可在个人中心查看'\n            });\n          } else {\n            ElMessage({\n              type: 'warning',\n              message: '您已经关注过了，可在个人中心查看'\n            });\n          }\n        });\n      }\n    },\n\n    //私信新闻作者\n    messageNewsAuthor() {\n      if (userEmail === null || userEmail === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        });\n      } else {\n        this.dialogFormVisible = true; //加载富文本编辑器\n\n        this.$nextTick(() => {\n          editor = new E('#div1');\n          editor.config.zIndex = 500;\n          editor.create();\n        });\n        this.messageForm.userFrom = userEmail;\n        this.messageForm.userTo = newsAuthor;\n        this.messageForm.headline = '';\n        this.messageForm.content = '';\n        editor.txt.html(\"\");\n      }\n    },\n\n    //私信评论作者\n    messageCommentAuthor(author) {\n      if (userEmail === null || userEmail === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        });\n      } else {\n        this.dialogFormVisible = true; //加载富文本编辑器\n\n        this.$nextTick(() => {\n          editor = new E('#div1');\n          editor.config.zIndex = 500;\n          editor.create();\n        });\n        this.messageForm.userFrom = userEmail;\n        this.messageForm.userTo = author;\n        this.messageForm.headline = '';\n        this.messageForm.content = '';\n        editor.txt.html(\"\");\n      }\n    },\n\n    //确认发送私信\n    submitForm() {\n      this.messageForm.content = editor.txt.html();\n\n      if (this.messageForm.headline === null || this.messageForm.headline === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请输入主题'\n        });\n      } else if (this.messageForm.content === null || this.messageForm.content === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请输入内容'\n        });\n      } else {\n        request.post(\"/message/sendMessage\", this.messageForm).then(res => {\n          ElMessage({\n            type: 'success',\n            message: '已送达'\n          });\n          this.dialogFormVisible = false;\n        });\n      }\n    },\n\n    //加载收藏信息\n    loadCollectData() {\n      if (userEmail === null || userEmail === \"\") {\n        this.notCollect = true;\n        this.collected = false;\n      } else {\n        request.get(\"/collect/getCollectInfo\", {\n          params: {\n            newsId: newsId,\n            userEmail: userEmail\n          }\n        }).then(res => {\n          if (res.data === \"未收藏\") {\n            this.notCollect = true;\n            this.collected = false;\n          } else {\n            this.collected = true;\n            this.notCollect = false;\n          }\n        });\n      }\n    },\n\n    //添加收藏\n    insertCollect() {\n      if (userEmail === null || userEmail === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        });\n      } else {\n        request.get(\"/collect/insertCollect\", {\n          params: {\n            newsId: newsId,\n            userEmail: userEmail\n          }\n        }).then(res => {\n          this.collected = true;\n          this.notCollect = false;\n          ElMessage({\n            type: 'success',\n            message: '收藏成功'\n          });\n        });\n      }\n    },\n\n    //取消收藏\n    deleteCollect() {\n      request.get(\"/collect/deleteCollect\", {\n        params: {\n          newsId: newsId,\n          userEmail: userEmail\n        }\n      }).then(res => {\n        this.notCollect = true;\n        this.collected = false;\n        ElMessage({\n          type: 'success',\n          message: '已取消'\n        });\n      });\n    }\n\n  },\n\n  created() {\n    document.body.style.overflow = 'scroll';\n    document.body.style.overflowX = 'hidden';\n    this.loadNewsData();\n    this.loadCommentData();\n    let str = sessionStorage.getItem(\"userEmail\");\n\n    if (str === null || str === \"\") {\n      userEmail = str;\n    } else {\n      let reg = new RegExp('\"', \"g\");\n      userEmail = str.replace(reg, \"\"); //正则表达式，将字符串两端的双引号去掉\n    }\n\n    this.loadCollectData();\n  }\n\n};","map":{"version":3,"mappings":"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","names":["request","$","ElMessage","moment","HeadOfHome","Star","StarFilled","E","newsId","newsAuthor","userEmail","editor","name","components","data","boyHeadAuthor","girlHeadAuthor","notCollect","collected","total","pageSize","currentPage","tableDataForComment","textarea","commentArea","messageForm","userFrom","userTo","headline","content","date","state","dialogFormVisible","methods","handleCurrentChange","loadCommentData","loadNewsData","$route","query","console","log","post","then","res","text","type","sex","petname","format","html","author","get","params","records","length","i","publishComment","message","comment","val","focusNewsAuthor","code","focusCommentAuthor","messageNewsAuthor","$nextTick","config","zIndex","create","txt","messageCommentAuthor","submitForm","loadCollectData","insertCollect","deleteCollect","created","document","body","style","overflow","overflowX","str","sessionStorage","getItem","reg","RegExp","replace"],"sourceRoot":"","sources":["/Users/wangjin/Desktop/newspublisher/Vue/src/layout/NewsContent.vue"],"sourcesContent":["<template>\n  <!--头部-->\n  <HeadOfHome/>\n  <div class=\"dF\">\n    <!--新闻内容-->\n    <table class=\"t1\">\n      <tr class=\"tr1\">\n        <td colspan=\"2\" class=\"td1\">[<span id=\"type\"></span>]&nbsp;&nbsp;<span id=\"headline\"></span></td>\n      </tr>\n      <tr class=\"tr2\">\n        <td class=\"td2\">\n          <img src=\"../assets/photo/boy.png\" alt=\"\" class=\"boy\" id=\"boy\" v-if=\"boyHeadAuthor\">\n          <img src=\"../assets/photo/girl.png\" alt=\"\" class=\"girl\" id=\"girl\" v-if=\"girlHeadAuthor\">\n        </td>\n        <td>\n          <span id=\"author\"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n          <span id=\"date\"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n          <el-button type=\"text\" @click=\"focusNewsAuthor()\" class=\"el1\">关注TA</el-button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n          <el-button type=\"text\" @click=\"messageNewsAuthor()\" class=\"el2\">私信TA</el-button>\n        </td>\n      </tr>\n      <tr>\n        <td colspan=\"2\" id=\"content\"></td>\n      </tr>\n    </table>\n    <table class=\"t2\">\n      <tr>\n        <td v-if=\"notCollect\" class=\"td3\"><img @click=\"insertCollect()\" src=\"../assets/photo/collect.png\" alt=\"\" style=\"width: 30px;height: 30px;\"><span style=\"position: relative;top: -8px;left: 10px;\">点击收藏</span></td>\n        <td v-if=\"collected\"  class=\"td4\"><img @click=\"deleteCollect()\" src=\"../assets/photo/collected.png\" alt=\"\" style=\"width: 30px;height: 30px;\"><span style=\"position: relative;top: -8px;left: 10px;\">取消收藏</span></td>\n      </tr>\n    </table>\n    <el-table :data=\"tableDataForComment\" class=\"el3\" v-if=\"commentArea\" :cell-style=\"{background:'#ffffff'}\">\n      <el-table-column label=\"\" width=\"\">\n        <template #default=\"scope\">\n          <table class=\"t3\" v-if=\"scope.row.sex==='男'\">\n            <tr class=\"tr3\">\n              <td class=\"td5\">\n                <div class=\"dS\">\n                  <img src=\"../assets/photo/boy.png\" alt=\"\" class=\"im1\"><br>\n                  <span class=\"sp1\">{{scope.row.petname}}</span><br>\n                  <el-button type=\"text\" @click=\"focusCommentAuthor(scope.row.author)\" class=\"el4\">关注TA</el-button><br>\n                  <el-button type=\"text\" @click=\"messageCommentAuthor(scope.row.author)\" class=\"el5\">私信TA</el-button>\n                </div>\n              </td>\n              <td class=\"td6\">\n                <span>{{scope.row.content}}</span>\n              </td>\n            </tr>\n            <tr class=\"tr4\">\n              <td colspan=\"2\" class=\"td7\"><span>{{scope.row.date}}</span></td>\n            </tr>\n          </table>\n          <table class=\"t4\" v-if=\"scope.row.sex==='女'\">\n            <tr class=\"tr5\">\n              <td class=\"td8\">\n                <div class=\"dT\">\n                  <img src=\"../assets/photo/girl.png\" alt=\"\" class=\"im2\"><br>\n                  <span class=\"sp2\">{{scope.row.petname}}</span><br>\n                  <el-button type=\"text\" @click=\"focusCommentAuthor(scope.row.author)\" class=\"el6\">关注TA</el-button><br>\n                  <el-button type=\"text\" @click=\"messageCommentAuthor(scope.row.author)\" class=\"el7\">私信TA</el-button>\n                </div>\n              </td>\n              <td class=\"td9\">\n                <span>{{scope.row.content}}</span>\n              </td>\n            </tr>\n            <tr class=\"tr6\">\n              <td colspan=\"2\" class=\"td10\"><span>{{scope.row.date}}</span></td>\n            </tr>\n          </table>\n        </template>\n      </el-table-column>\n    </el-table>\n    <!--分页组件-->\n    <el-pagination\n        background\n        layout=\"total, prev, pager, next\"\n        :total=\"total\"\n        :page-size=\"pageSize\"\n        v-model:currentPage=\"currentPage\"\n        @current-change=\"handleCurrentChange\"\n        class=\"el8\">\n    </el-pagination>\n    <div class=\"d5\">\n      <el-input\n          class=\"el9\"\n          v-model=\"textarea\"\n          :rows=\"10\"\n          type=\"textarea\"\n          placeholder=\"请输入您的评论\"\n          id=\"comment\"/>\n      <el-button class=\"el10\" type=\"primary\" @click=\"publishComment()\">发表评论</el-button>\n    </div>\n  </div>\n  <!--私信弹窗，点击私信时才显示-->\n  <el-dialog v-model=\"dialogFormVisible\" title=\"发送私信\">\n    <el-form model=\"messageForm\">\n      <el-form-item label=\"主题\" prop=\"headline\">\n        <el-input v-model=\"messageForm.headline\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"内容\" prop=\"content\">\n        <!--富文本编辑器-->\n        <div id=\"div1\">\n        </div>\n      </el-form-item>\n    </el-form>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submitForm()\">发送</el-button>\n      </span>\n    </template>\n  </el-dialog>\n  <el-backtop />\n</template>\n\n<script>\nimport request from \"../utils/request\";\nimport $ from \"../assets/js/jquery-3.6.0\";\nimport {ElMessage} from \"element-plus\";\nimport moment from \"moment\";\nimport HeadOfHome from \"../components/HeadOfHome\";\nimport Star from \"@element-plus/icons/lib/Star\";\nimport StarFilled from \"@element-plus/icons/lib/StarFilled\";\nimport E from 'wangeditor'\n\nlet newsId;\nlet newsAuthor;\nlet userEmail;\nlet editor;\nexport default {\n  name: \"NewsContent\",\n  components: {\n    HeadOfHome,\n    Star,\n    StarFilled,\n  },\n  data() {\n    return {\n      boyHeadAuthor: false,\n      girlHeadAuthor: false,\n      notCollect: false,\n      collected: false,\n      total: 0,\n      pageSize: 5,\n      currentPage: 1,\n      tableDataForComment: [\n\n      ],\n      textarea: '',\n      commentArea: false,\n      newsAuthor: newsAuthor,\n      messageForm: {\n        userFrom: '',\n        userTo: '',\n        headline: '',\n        content: '',\n        date: '',\n        state: 0\n      },\n      dialogFormVisible: false\n    }\n  },\n  methods: {\n    handleCurrentChange() {\n      this.loadCommentData()\n    },\n    //加载新闻内容数据\n    loadNewsData() {\n      newsId = this.$route.query.newsId\n      console.log(newsId)\n      //使该新闻的点击量加1\n      request.post(\"/news/increaseNewsClick\",newsId).then(res =>{\n        request.post(\"/news_User/getNewsById\",newsId).then(res =>{\n          $('#type').text(res.data.type)\n          $('#headline').text(res.data.headline)\n          if (res.data.sex===\"男\") {\n            this.boyHeadAuthor = true\n            this.girlHeadAuthor = false\n          }else {\n            this.boyHeadAuthor = false\n            this.girlHeadAuthor = true\n          }\n          $('#author').text(res.data.petname)\n          $('#date').text(moment(res.data.date).format(\"YYYY-MM-DD\"))\n          $('#content').html(res.data.content)\n          newsAuthor = res.data.author\n        })\n      })\n    },\n    //加载评论数据\n    loadCommentData() {\n      request.get(\"/comment_User/getAllCommentByNewsId\",{\n        params: {\n          newsId: newsId,\n          currentPage: this.currentPage,\n          pageSize: this.pageSize\n        }\n      }).then(res =>{\n        if (res.data.records.length===0) {\n\n        }else {\n          for (let i=0;i<res.data.records.length;i++) {\n            res.data.records[i].date = moment(res.data.records[i].date).format(\"YYYY-MM-DD\")\n          }\n          this.tableDataForComment = res.data.records\n          this.total = res.data.total\n          this.commentArea = true\n        }\n      })\n    },\n    //发表评论\n    publishComment() {\n      if (this.textarea===null||this.textarea===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请输入评论'\n        })\n      }else if (userEmail===null||userEmail===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        })\n      }else {\n        let comment = {\n          newsId: newsId,\n          author: userEmail,\n          content: this.textarea\n        }\n        request.post(\"/comment/insertComment\",comment).then(res =>{\n          ElMessage({\n            type: 'success',\n            message: '评论成功'\n          })\n          request.post(\"/news/increaseNewsComment\",newsId).then(res =>{\n            $('#comment').val(\"\")   //清空评论区\n            this.loadCommentData()\n          })\n        })\n      }\n    },\n    //关注新闻作者\n    focusNewsAuthor() {\n      if (userEmail===null||userEmail===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        })\n      }else {\n        request.get(\"/focus/focusUser\",{\n          params: {\n            userFrom: userEmail,\n            userTo: newsAuthor\n          }\n        }).then(res =>{\n          if (res.code===\"0\") {\n            ElMessage({\n              type: 'success',\n              message: '关注成功，可在个人中心查看'\n            })\n          }else {\n            ElMessage({\n              type: 'warning',\n              message: '您已经关注过了，可在个人中心查看'\n            })\n          }\n        })\n      }\n    },\n    //关注评论作者\n    focusCommentAuthor(author) {\n      if (userEmail===null||userEmail===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        })\n      }else {\n        request.get(\"/focus/focusUser\",{\n          params: {\n            userFrom: userEmail,\n            userTo: author\n          }\n        }).then(res =>{\n          if (res.code===\"0\") {\n            ElMessage({\n              type: 'success',\n              message: '关注成功，可在个人中心查看'\n            })\n          }else {\n            ElMessage({\n              type: 'warning',\n              message: '您已经关注过了，可在个人中心查看'\n            })\n          }\n        })\n      }\n    },\n    //私信新闻作者\n    messageNewsAuthor() {\n      if (userEmail===null||userEmail===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        })\n      }else {\n        this.dialogFormVisible = true\n        //加载富文本编辑器\n        this.$nextTick(() => {\n          editor = new E('#div1')\n          editor.config.zIndex = 500\n          editor.create()\n        })\n        this.messageForm.userFrom = userEmail\n        this.messageForm.userTo = newsAuthor\n        this.messageForm.headline = ''\n        this.messageForm.content = ''\n        editor.txt.html(\"\")\n      }\n    },\n    //私信评论作者\n    messageCommentAuthor(author) {\n      if (userEmail===null||userEmail===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        })\n      }else {\n        this.dialogFormVisible = true\n        //加载富文本编辑器\n        this.$nextTick(() => {\n          editor = new E('#div1')\n          editor.config.zIndex = 500\n          editor.create()\n        })\n        this.messageForm.userFrom = userEmail\n        this.messageForm.userTo = author\n        this.messageForm.headline = ''\n        this.messageForm.content = ''\n        editor.txt.html(\"\")\n      }\n    },\n    //确认发送私信\n    submitForm() {\n      this.messageForm.content = editor.txt.html()\n      if (this.messageForm.headline===null||this.messageForm.headline===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请输入主题'\n        })\n      }else if (this.messageForm.content===null||this.messageForm.content===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请输入内容'\n        })\n      }else {\n        request.post(\"/message/sendMessage\",this.messageForm).then(res =>{\n          ElMessage({\n            type: 'success',\n            message: '已送达'\n          })\n          this.dialogFormVisible = false\n        })\n      }\n    },\n    //加载收藏信息\n    loadCollectData() {\n      if (userEmail===null||userEmail===\"\") {\n        this.notCollect = true\n        this.collected = false\n      }else {\n        request.get(\"/collect/getCollectInfo\",{\n          params: {\n            newsId: newsId,\n            userEmail: userEmail\n          }\n        }).then(res =>{\n          if (res.data===\"未收藏\") {\n            this.notCollect = true\n            this.collected = false\n          }else {\n            this.collected = true\n            this.notCollect = false\n          }\n        })\n      }\n    },\n    //添加收藏\n    insertCollect() {\n      if (userEmail===null||userEmail===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请登录或注册后重试'\n        })\n      }else {\n        request.get(\"/collect/insertCollect\",{\n          params: {\n            newsId: newsId,\n            userEmail: userEmail\n          }\n        }).then(res =>{\n          this.collected = true\n          this.notCollect = false\n          ElMessage({\n            type: 'success',\n            message: '收藏成功'\n          })\n        })\n      }\n    },\n    //取消收藏\n    deleteCollect() {\n      request.get(\"/collect/deleteCollect\",{\n        params: {\n          newsId: newsId,\n          userEmail: userEmail\n        }\n      }).then(res =>{\n        this.notCollect = true\n        this.collected = false\n        ElMessage({\n          type: 'success',\n          message: '已取消'\n        })\n      })\n    },\n  },\n  created() {\n    document.body.style.overflow = 'scroll'\n    document.body.style.overflowX = 'hidden'\n    this.loadNewsData()\n    this.loadCommentData()\n    let str = sessionStorage.getItem(\"userEmail\")\n    if (str===null||str===\"\") {\n      userEmail = str\n    }else {\n      let reg = new RegExp('\"', \"g\");\n      userEmail = str.replace(reg, \"\");    //正则表达式，将字符串两端的双引号去掉\n    }\n    this.loadCollectData()\n  }\n}\n</script>\n\n<style scoped>\n.el-table tbody tr:hover>td {\n  background-color:#ffffff!important\n}\n.dF{\n  position: absolute;height: auto;width: 60%;background: white;left: 18.8%;margin-top: 70px;padding-right: 1.2%;padding-left: 1.2%;box-shadow: 0 0 3px 3px #f3f3f3;\n}\n.t1{\n  width: 100%;\n}\n.tr1{\n  height: 80px;\n}\n.td1{\n  font-size: 22px\n}\n.tr2{\n  height: 60px;position: relative;top: -10px;left: 10px;\n}\n.td2{\n  width: 6%;\n}\n.boy{\n  height: 40px;width: 40px;border-radius: 20px;\n}\n.girl{\n  height: 40px;width: 40px;border-radius: 20px;\n}\n.el1{\n  text-decoration: none;color: red;font-size: 15px;\n}\n.el2{\n  text-decoration: none;color: red;font-size: 15px;\n}\n.t2{\n  width: 100%;height: 250px;\n}\n.td3{\n  text-align: center;padding-top: 30px;\n}\n.td4{\n  text-align: center;padding-top: 30px;\n}\n.el3{\n  width: 100%;\n}\n.t3{\n  width: 100%;\n}\n.tr3{\n  background: #fafafa;\n}\n.td5{\n  width: 15%;text-align: center;\n}\n.dS{\n  padding: 20px;\n}\n.im1{\n  height: 50px;width: 50px;padding: 15px;padding-bottom: 20px;\n}\n.sp1{\n  font-size: 15px;\n}\n.el4{\n  text-decoration: none;color: red;font-size: 13px;position: relative;top: 5px;\n}\n.el5{\n  text-decoration: none;color: red;font-size: 13px;position: relative;top: 8px;\n}\n.td6{\n  padding: 10px;\n}\n.tr4{\n  font-size: 12px;text-align: right;\n}\n.td7{\n  padding-bottom: 20px;\n}\n.t4{\n  width: 100%;\n}\n.tr5{\n  background: #fafafa;\n}\n.td8{\n  width: 15%;text-align: center;\n}\n.dT{\n  padding: 20px;\n}\n.im2{\n  height: 50px;width: 50px;padding: 15px;padding-bottom: 20px;\n}\n.sp2{\n  font-size: 15px;\n}\n.el6{\n  text-decoration: none;color: red;font-size: 13px;position: relative;top: 5px;\n}\n.el7{\n  text-decoration: none;color: red;font-size: 13px;position: relative;top: 8px;\n}\n.td9{\n  padding: 10px;\n}\n.tr6{\n  font-size: 12px;text-align: right;\n}\n.td10{\n  padding-bottom: 20px;\n}\n.el8{\n  margin-top: 15px;\n}\n.d5{\n  text-align: center\n}\n.el9{\n  padding-top: 30px;padding-bottom: 30px;\n}\n.el10{\n  margin-bottom: 60px;\n}\n</style>"]},"metadata":{},"sourceType":"module"}