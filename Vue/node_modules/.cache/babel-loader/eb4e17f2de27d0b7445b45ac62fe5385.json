{"ast":null,"code":"import request from \"../../utils/request\";\nimport { ElMessage } from \"element-plus\";\nimport E from 'wangeditor';\nlet editor;\nexport default {\n  name: \"BroadcastManage\",\n\n  data() {\n    return {\n      ruleForm: {\n        userFrom: '',\n        userTo: '',\n        headline: '',\n        content: '',\n        date: '',\n        state: 0\n      },\n      rules: {\n        headline: [{\n          required: true,\n          message: '请输入主题',\n          trigger: 'blur'\n        }],\n        date: [{\n          type: 'date',\n          required: true,\n          message: '请选择日期',\n          trigger: 'change'\n        }]\n      }\n    };\n  },\n\n  methods: {\n    //重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n      editor.txt.html(\"\");\n    },\n\n    //提交表单\n    submitForm(formName) {\n      this.$refs[formName].validate(valid => {\n        if (valid) {\n          //如果表单不空\n          if (editor.txt.html() === '' || editor.txt.html() === \"\") {\n            ElMessage({\n              type: 'warning',\n              message: '请输入内容'\n            });\n          } else {\n            this.ruleForm.content = editor.txt.html();\n            request.post(\"/user/getAllUserEmail\").then(res => {\n              let userEmailList = res.data;\n\n              for (let i = 0; i < userEmailList.length; i++) {\n                let reg = new RegExp('\"', \"g\");\n                let newStr = userEmailList[i].replace(reg, \"\"); //正则表达式，将字符串两端的双引号去掉\n\n                this.ruleForm.userTo = newStr;\n                request.post(\"/message/sendMessageToAllUser\", this.ruleForm).then(res => {});\n              }\n\n              ElMessage({\n                type: 'success',\n                message: '发送成功'\n              });\n              this.resetForm(formName);\n            });\n          }\n        } else {\n          //如果表单为空\n          return false;\n        }\n      });\n    },\n\n    //加载数据\n    load() {\n      let userEmail = sessionStorage.getItem(\"userEmail\");\n      let reg = new RegExp('\"', \"g\");\n      let newStr = userEmail.replace(reg, \"\"); //正则表达式，将字符串两端的双引号去掉\n\n      this.ruleForm.userFrom = newStr; //加载富文本编辑器\n\n      this.$nextTick(() => {\n        editor = new E('#div1');\n        editor.config.zIndex = 500;\n        editor.create();\n      });\n    }\n\n  },\n\n  created() {\n    this.load();\n  }\n\n};","map":{"version":3,"mappings":"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","names":["request","ElMessage","E","editor","name","data","ruleForm","userFrom","userTo","headline","content","date","state","rules","required","message","trigger","type","methods","resetForm","formName","$refs","resetFields","txt","html","submitForm","validate","valid","post","then","res","userEmailList","i","length","reg","RegExp","newStr","replace","load","userEmail","sessionStorage","getItem","$nextTick","config","zIndex","create","created"],"sourceRoot":"","sources":["/Users/wangjin/Desktop/newspublisher/Vue/src/views/admin/BroadcastManage.vue"],"sourcesContent":["<template>\n  <div class=\"dF\">\n    <el-form\n        ref=\"ruleForm\"\n        :model=\"ruleForm\"\n        :rules=\"rules\"\n        label-width=\"80px\"\n        class=\"demo-ruleForm\">\n      <el-form-item label=\"主题\" prop=\"headline\">\n        <el-input v-model=\"ruleForm.headline\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"日期\" required>\n        <el-col :span=\"11\"><el-form-item prop=\"date\" ><el-date-picker v-model=\"ruleForm.date\" type=\"date\" placeholder=\"请选择日期\" style=\"width: 100%;\"></el-date-picker></el-form-item></el-col>\n      </el-form-item>\n      <el-form-item label=\"内容\" prop=\"content\">\n        <!--富文本编辑器-->\n        <div id=\"div1\">\n        </div>\n      </el-form-item>\n      <el-form-item class=\"el3\">\n        <el-button type=\"primary\" @click=\"submitForm('ruleForm')\" class=\"el4\">发送</el-button>\n        <el-button @click=\"resetForm('ruleForm')\" class=\"el5\">重置</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport request from \"../../utils/request\";\nimport {ElMessage} from \"element-plus\";\nimport E from 'wangeditor'\n\nlet editor;\nexport default {\n  name: \"BroadcastManage\",\n  data() {\n    return {\n      ruleForm: {\n        userFrom: '',\n        userTo: '',\n        headline: '',\n        content: '',\n        date: '',\n        state: 0\n      },\n      rules: {\n        headline:[\n          {\n            required: true,\n            message: '请输入主题',\n            trigger: 'blur',\n          },\n        ],\n        date: [\n          {\n            type: 'date',\n            required: true,\n            message: '请选择日期',\n            trigger: 'change',\n          },\n        ],\n      },\n    }\n  },\n  methods: {\n    //重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n      editor.txt.html(\"\")\n    },\n    //提交表单\n    submitForm(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {    //如果表单不空\n          if (editor.txt.html()===''||editor.txt.html()===\"\") {\n            ElMessage({\n              type: 'warning',\n              message: '请输入内容'\n            })\n          }else {\n            this.ruleForm.content = editor.txt.html()\n            request.post(\"/user/getAllUserEmail\").then(res =>{\n              let userEmailList = res.data\n              for (let i=0;i<userEmailList.length;i++) {\n                let reg = new RegExp('\"', \"g\");\n                let newStr = userEmailList[i].replace(reg, \"\");    //正则表达式，将字符串两端的双引号去掉\n                this.ruleForm.userTo = newStr\n                request.post(\"/message/sendMessageToAllUser\",this.ruleForm).then(res =>{\n                })\n              }\n              ElMessage({\n                type: 'success',\n                message: '发送成功'\n              })\n              this.resetForm(formName)\n            })\n          }\n        } else {        //如果表单为空\n          return false\n        }\n      })\n    },\n    //加载数据\n    load() {\n      let userEmail = sessionStorage.getItem(\"userEmail\")\n      let reg = new RegExp('\"', \"g\");\n      let newStr = userEmail.replace(reg, \"\");    //正则表达式，将字符串两端的双引号去掉\n      this.ruleForm.userFrom = newStr\n      //加载富文本编辑器\n      this.$nextTick(() => {\n        editor = new E('#div1')\n        editor.config.zIndex = 500\n        editor.create()\n      })\n    },\n  },\n  created() {\n    this.load()\n  }\n}\n</script>\n\n<style scoped>\n.dF{\n  width: 70%;position: absolute;left: 10%;right: 20%;margin-top: 20px;\n}\n.el-col-11[data-v-55fcbdfc]{\n  max-width: 100%;width: 100%;\n}\n.el4{\n  width: 40%;\n}\n.el5{\n  width: 40%;margin-left: 20%;\n}\n</style>"]},"metadata":{},"sourceType":"module"}