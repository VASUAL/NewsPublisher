{"ast":null,"code":"import request from \"../../utils/request\";\nimport E from \"wangeditor\";\nimport { ElMessage } from \"element-plus\";\nimport moment from 'moment';\nimport $ from '../../assets/js/jquery-3.6.0'; //引入jQuery\n\nlet editor;\nlet rowForUpdate;\nexport default {\n  name: \"LogList\",\n\n  data() {\n    return {\n      tableData: [],\n      total: 0,\n      pageSize: 5,\n      currentPage: 1,\n      formForEdit: {\n        idEdit: '',\n        versionEdit: '',\n        dateEdit: '',\n        contentEdit: ''\n      },\n      dialogFormVisibleForEdit: false,\n      dialogFormVisibleForDelete: false,\n      dialogFormVisibleForLook: false\n    };\n  },\n\n  created() {\n    this.loadData();\n  },\n\n  methods: {\n    //格式化日期\n    timeFilter(row, column, cellValue, index) {\n      const date = row[column.property];\n\n      if (date != null) {\n        return moment(date).format(\"YYYY-MM-DD\");\n      }\n    },\n\n    //当前页码改变\n    handleCurrentChange() {\n      this.loadData();\n    },\n\n    //加载数据\n    loadData() {\n      request.get(\"/log/getAllLog\", {\n        params: {\n          currentPage: this.currentPage,\n          pageSize: this.pageSize\n        }\n      }).then(res => {\n        this.tableData = res.data.records;\n        this.total = res.data.total;\n      });\n    },\n\n    //查看详情\n    look(row) {\n      this.dialogFormVisibleForLook = true;\n      this.$nextTick(() => {\n        $('#content').html(row.content);\n      });\n    },\n\n    //修改日志\n    edit(row) {\n      //显示修改窗口\n      this.dialogFormVisibleForEdit = true; //加载富文本编辑器\n\n      this.$nextTick(() => {\n        editor = new E('#div1');\n        editor.config.zIndex = 500;\n        editor.create();\n      }); //回显富文本编辑器\n\n      this.$nextTick(() => {\n        let content = row.content;\n        editor.txt.html(content);\n      }); //绑定数据\n\n      this.formForEdit.idEdit = row.id;\n      this.formForEdit.versionEdit = row.version;\n      this.formForEdit.dateEdit = row.date;\n    },\n\n    //确认修改\n    conformEdit() {\n      this.formForEdit.contentEdit = editor.txt.html();\n\n      if (this.formForEdit.versionEdit === null || this.formForEdit.versionEdit === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请输入版本'\n        });\n      } else if (this.formForEdit.dateEdit === null || this.formForEdit.dateEdit === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请选择日期'\n        });\n      } else if (this.formForEdit.contentEdit === null || this.formForEdit.contentEdit === \"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请输入内容'\n        });\n      } else {\n        let formForEdit = {\n          id: this.formForEdit.idEdit,\n          version: this.formForEdit.versionEdit,\n          content: this.formForEdit.contentEdit,\n          date: this.formForEdit.dateEdit\n        };\n        request.post(\"/log/editLog\", formForEdit).then(res => {\n          ElMessage({\n            type: 'success',\n            message: '修改成功'\n          });\n          this.dialogFormVisibleForEdit = false;\n          this.loadData();\n        });\n      }\n    },\n\n    //删除日志\n    delete(row) {\n      rowForUpdate = row;\n      this.dialogFormVisibleForDelete = true;\n    },\n\n    //确认删除\n    conformDelete() {\n      request.post(\"/log/deleteLog\", rowForUpdate.id).then(res => {\n        ElMessage({\n          type: 'success',\n          message: '删除成功'\n        });\n        this.loadData(); //请求后的操作要放到请求的大括号里面，否则异步操作会造成加载时数据没有更新\n\n        this.dialogFormVisibleForDelete = false;\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["request","E","ElMessage","moment","$","editor","rowForUpdate","name","data","tableData","total","pageSize","currentPage","formForEdit","idEdit","versionEdit","dateEdit","contentEdit","dialogFormVisibleForEdit","dialogFormVisibleForDelete","dialogFormVisibleForLook","created","loadData","methods","timeFilter","row","column","cellValue","index","date","property","format","handleCurrentChange","get","params","then","res","records","look","$nextTick","html","content","edit","config","zIndex","create","txt","id","version","conformEdit","type","message","post","delete","conformDelete"],"sourceRoot":"","sources":["/Users/wangjin/Desktop/newspublisher/Vue/src/views/admin/LogList.vue"],"sourcesContent":["<template>\n  <div class=\"dF\">\n    <el-table :data=\"tableData\" border class=\"el1\">\n      <el-table-column prop=\"id\" label=\"编号\" width=\"\" align=\"center\" v-if=\"false\" />\n      <el-table-column prop=\"version\" label=\"版本\" width=\"300\" align=\"center\" />\n      <el-table-column prop=\"date\" label=\"发布日期\" width=\"300\" align=\"center\" :formatter=\"timeFilter\"/>\n      <el-table-column prop=\"content\" label=\"内容\" width=\"100\" align=\"center\"  v-if=\"false\"/>\n      <el-table-column label=\"操作\" width=\"\" align=\"center\" key=\"slot\">\n        <!--此处使用了插槽，来实现获得某行的对象-->\n        <template #default=\"scope\" >\n          <el-button type=\"text\" size=\"big\" @click=\"this.look(scope.row)\">查看</el-button>\n          <el-button type=\"text\" size=\"big\" @click=\"this.edit(scope.row)\">修改</el-button>\n          <el-button type=\"text\" size=\"big\" @click=\"this.delete(scope.row)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <!--分页组件-->\n    <el-pagination\n        background\n        layout=\"total, prev, pager, next\"\n        :total=\"total\"\n        :page-size=\"pageSize\"\n        v-model:currentPage=\"currentPage\"\n        @current-change=\"handleCurrentChange\"\n        class=\"el2\">\n    </el-pagination>\n  </div>\n  <!--修改日志弹窗，点击修改时才显示-->\n  <el-dialog v-model=\"dialogFormVisibleForEdit\" title=\"修改日志\" width=\"60%\">\n    <el-form\n        :model=\"formForEdit\"\n        label-width=\"80px\">\n      <el-form-item label=\"版本\" prop=\"version\">\n        <el-input v-model=\"formForEdit.versionEdit\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"日期\">\n        <el-col :span=\"11\"><el-form-item prop=\"date\"><el-date-picker v-model=\"formForEdit.dateEdit\" type=\"date\" placeholder=\"请选择日期\" style=\"width: 100%\"></el-date-picker></el-form-item></el-col>\n      </el-form-item>\n      <el-form-item label=\"内容\" prop=\"content\">\n        <!--富文本编辑器-->\n        <div id=\"div1\">\n        </div>\n      </el-form-item>\n    </el-form>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisibleForEdit=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"conformEdit()\">确定</el-button>\n      </span>\n    </template>\n  </el-dialog>\n  <!--删除日志弹窗，点击删除时才显示-->\n  <el-dialog v-model=\"dialogFormVisibleForDelete\" title=\"删除日志\">\n    <span>是否确认删除该日志？</span>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisibleForDelete = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"conformDelete()\">确定</el-button>\n      </span>\n    </template>\n  </el-dialog>\n  <!--查看日志弹窗，点击查看时才显示-->\n  <el-dialog v-model=\"dialogFormVisibleForLook\" title=\"查看日志\">\n    <div id=\"content\"></div>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button type=\"primary\" @click=\"dialogFormVisibleForLook=false\">关闭</el-button>\n      </span>\n    </template>\n  </el-dialog>\n</template>\n\n<script>\nimport request from \"../../utils/request\";\nimport E from \"wangeditor\";\nimport {ElMessage} from \"element-plus\";\nimport moment from 'moment';\nimport $ from '../../assets/js/jquery-3.6.0';  //引入jQuery\n\nlet editor;\nlet rowForUpdate;\n\nexport default {\n  name: \"LogList\",\n  data() {\n    return {\n      tableData: [\n\n      ],\n      total: 0,\n      pageSize: 5,\n      currentPage: 1,\n      formForEdit: {\n        idEdit: '',\n        versionEdit: '',\n        dateEdit: '',\n        contentEdit: ''\n      },\n      dialogFormVisibleForEdit: false,\n      dialogFormVisibleForDelete: false,\n      dialogFormVisibleForLook: false\n    }\n  },\n  created() {\n    this.loadData()\n  },\n  methods: {\n    //格式化日期\n    timeFilter(row, column, cellValue, index) {\n      const date = row[column.property]\n      if(date !=null){\n        return moment(date).format(\"YYYY-MM-DD\")\n      }\n    },\n    //当前页码改变\n    handleCurrentChange() {\n      this.loadData()\n    },\n    //加载数据\n    loadData() {\n      request.get(\"/log/getAllLog\",{\n        params: {\n          currentPage: this.currentPage,\n          pageSize: this.pageSize\n        }\n      }).then(res => {\n        this.tableData = res.data.records\n        this.total = res.data.total\n      })\n    },\n    //查看详情\n    look(row) {\n      this.dialogFormVisibleForLook = true\n      this.$nextTick(() =>{\n        $('#content').html(row.content)\n      })\n    },\n    //修改日志\n    edit(row) {\n      //显示修改窗口\n      this.dialogFormVisibleForEdit = true\n      //加载富文本编辑器\n      this.$nextTick(() =>{\n        editor = new E('#div1')\n        editor.config.zIndex = 500\n        editor.create()\n      })\n      //回显富文本编辑器\n      this.$nextTick(() => {\n        let content = row.content\n        editor.txt.html(content)\n      })\n      //绑定数据\n      this.formForEdit.idEdit = row.id\n      this.formForEdit.versionEdit = row.version\n      this.formForEdit.dateEdit = row.date\n    },\n    //确认修改\n    conformEdit() {\n      this.formForEdit.contentEdit = editor.txt.html()\n      if (this.formForEdit.versionEdit===null||this.formForEdit.versionEdit===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请输入版本'\n        })\n      }else if (this.formForEdit.dateEdit===null||this.formForEdit.dateEdit===\"\") {\n        ElMessage({\n          type: 'warning',\n          message: '请选择日期'\n        })\n      }else if (this.formForEdit.contentEdit===null||this.formForEdit.contentEdit===\"\"){\n        ElMessage({\n          type: 'warning',\n          message: '请输入内容'\n        })\n      }else {\n        let formForEdit =  {\n          id: this.formForEdit.idEdit,\n          version: this.formForEdit.versionEdit,\n          content: this.formForEdit.contentEdit,\n          date: this.formForEdit.dateEdit\n        }\n        request.post(\"/log/editLog\",formForEdit).then(res =>{\n          ElMessage({\n            type: 'success',\n            message: '修改成功'\n          })\n          this.dialogFormVisibleForEdit = false\n          this.loadData()\n        })\n      }\n    },\n    //删除日志\n    delete(row) {\n      rowForUpdate = row\n      this.dialogFormVisibleForDelete = true\n    },\n    //确认删除\n    conformDelete() {\n      request.post(\"/log/deleteLog\",rowForUpdate.id).then(res =>{\n        ElMessage({\n          type: 'success',\n          message: '删除成功'\n        })\n        this.loadData()       //请求后的操作要放到请求的大括号里面，否则异步操作会造成加载时数据没有更新\n        this.dialogFormVisibleForDelete = false\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.dF{\n  width: 90%;position: absolute;left: 5%;right: 5%;margin-top: 50px;\n}\n.el1{\n  width: 100%;\n}\n.el2{\n  margin-top: 15px;\n}\n.el-col-11[data-v-55fcbdfc]{\n  max-width: 100%;width: 100%;\n}\n</style>"]},"metadata":{},"sourceType":"module"}